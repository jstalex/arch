<!DOCTYPE html>
<html>
<head>
    <title>Парикмахерская - Управление заказами</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .form-group { margin-bottom: 15px; }
        .form-row { display: flex; gap: 15px; }
        .form-col { flex: 1; }
        button { 
            background-color: #4CAF50; 
            color: white; 
            border: none; 
            padding: 8px 15px; 
            cursor: pointer; 
            margin-top: 10px;
        }
        button.delete { background-color: #f44336; }
        button:hover { opacity: 0.8; }
        input, select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            margin-top: 5px;
        }
        .alert {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .alert-success { background-color: #dff0d8; color: #3c763d; }
        .alert-error { background-color: #f2dede; color: #a94442; }
        .alert-info { background-color: #d9edf7; color: #31708f; }
        .required:after { content: " *"; color: red; }
        .required-field { border-left: 3px solid red; padding-left: 5px; }
    </style>
</head>
<body>
    <h1>Управление заказами</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="messages">
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <h2>Добавить новый заказ</h2>
    <form action="/add" method="post" onsubmit="return validateForm()">
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label for="first_name" class="required">Имя клиента:</label>
                    <input type="text" name="first_name" id="first_name" required class="required-field">
                </div>
                <div class="form-group">
                    <label for="last_name" class="required">Фамилия клиента:</label>
                    <input type="text" name="last_name" id="last_name" required class="required-field">
                </div>
                <div class="form-group">
                    <label for="phone" class="required">Телефон:</label>
                    <input type="text" name="phone" id="phone" required class="required-field">
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label for="haircut_id" class="required">Стрижка:</label>
                    <select name="haircut_id" id="haircut_id" required class="required-field">
                        <option value="">-- Выберите стрижку --</option>
                        {% for haircut in haircuts %}
                        <option value="{{ haircut[0] }}">{{ haircut[1] }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="barber_id" class="required">Мастер:</label>
                    <select name="barber_id" id="barber_id" required class="required-field">
                        <option value="">-- Выберите мастера --</option>
                        {% for barber in barbers %}
                        <option value="{{ barber[0] }}">{{ barber[1] }} {{ barber[2] }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        
        <button type="submit">Добавить заказ</button>
    </form>
    
    <h2>Список заказов</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Стрижка</th>
                <th>Клиент</th>
                <th>Мастер</th>
                <th>Дата</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order[0] }}</td>
                <td>{{ order[1] }}</td>
                <td>{{ order[2] }}</td>
                <td>{{ order[3] }}</td>
                <td>{{ order[4] }}</td>
                <td>
                    <button class="delete" onclick="window.location.href='/delete/{{ order[0] }}'">Удалить</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        // Client-side validation
        function validateForm() {
            let isValid = true;
            const requiredFields = document.querySelectorAll('[required]');
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.border = '1px solid red';
                    isValid = false;
                } else {
                    field.style.border = '';
                }
            });
            
            if (!isValid) {
                alert('Пожалуйста, заполните все обязательные поля!');
                return false;
            }
            return true;
        }

        // Phone number formatting
        document.getElementById('phone').addEventListener('input', function(e) {
            let x = this.value.replace(/\D/g, '').match(/(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);
            this.value = !x[2] ? x[1] : x[1] + ' (' + x[2] + ') ' + x[3] + (x[4] ? '-' + x[4] : '') + (x[5] ? '-' + x[5] : '');
        });
    </script>
</body>
</html>